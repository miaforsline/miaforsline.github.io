---
title: "CalEnviroScreen"
description: |
  EDS 222: Statistics for Environmental Data Science
  Fall 2021 Final Project 
author:
  - name: Mia Forsline
    url: {}
date: 2021-11-18
output:
  distill::distill_article:
    self_contained: false
    toc: true
    toc_float: true
preview: octocat.png
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      message = FALSE, 
                      warning = FALSE, 
                      include = TRUE)
library(tidyverse)
library(here)
library(gt)
library(lawstat)
```

# Research Question

In California from 2013 - 2021, does air quality (as measured by PM 2.5 concentrations) vary with poverty rates (as measured by the percent of the population living below two times the federal poverty level)?

# Background / Motivation

Why is this important? Is there existing evidence on this question? If so, why is it inconclusive? If not, why not?

# Methods

## Data Description / Collection

*Where did you access it? What are its spatial and temporal features? What are its limitations? What do you know about the sampling strategy and what biases that may introduce? If helpful, you can use a histogram, scatterplot, or summary statistics table to describe your data.*

```{r}
c1 <- read_csv(file = here("_posts", 
                           "2021-11-18-calenviroscreen", 
                           "CES", 
                           "CES_data", 
                           "ces1_2013.csv"))
c2 <- read_csv(file = here("_posts", 
                           "2021-11-18-calenviroscreen", 
                           "CES", 
                           "CES_data", 
                           "ces2_2014.csv"))
c3 <- read_csv(file = here("_posts", 
                           "2021-11-18-calenviroscreen", 
                           "CES", 
                           "CES_data", 
                           "ces3_2018.csv"))
c4 <- read_csv(file = here("_posts", 
                           "2021-11-18-calenviroscreen", 
                           "CES", 
                           "CES_data", 
                           "ces4_2021.csv"))

c1_clean <- c1 %>% 
  select(c("ZIP Code","Poverty", "PM2.5")) %>% 
  mutate(Year = "2013") %>% 
  dplyr::rename(ZIP = "ZIP Code") %>% 
  mutate(ZIP = as.numeric(ZIP))
c2_clean <- c2 %>% 
  select(c("Census Tract", "California County", "ZIP", "Longitude", "Latitude", "Poverty", "PM2.5")) %>% 
  mutate(Year = "2014",
         ZIP = as.numeric(ZIP))
c3_clean <- c3 %>% 
  select(c("Census Tract", "California County", "ZIP", "Longitude", "Latitude", "Poverty", "PM2.5")) %>% 
  mutate(Year = "2018",
         ZIP = as.numeric(ZIP))
c4_clean <- c4 %>% 
  select(c("Census Tract", "California County", "ZIP", "Longitude", "Latitude", "Poverty", "PM2.5")) %>% 
  mutate(Year = "2021",
         ZIP = as.numeric(ZIP))
```

```{r}
c1_fill <- full_join(x = c2_clean, y = c1_clean, 
                     by = "ZIP", 
                     suffix = c(".c2", ".c1")) %>%
  select(c("Census Tract", 
           "California County", 
           "ZIP", 
           "Longitude", 
           "Latitude", 
           "Poverty.c1", 
           "PM2.5.c1", 
           "Year.c1")) %>%
  dplyr::rename(Poverty = "Poverty.c1",
                PM2.5 = "PM2.5.c1",
                Year = "Year.c1")
```


```{r}
joined <- rbind(c4_clean, c3_clean, c2_clean, c1_fill) %>% 
  mutate(Year = as.factor(Year),
         Year = factor(x = Year, levels = c("2013", "2014", "2018", "2021"))) 
```

I downloaded 2013 - 2021 CalEnviroScreen data from the [California Office of Environmental Health Hazard Assessment (OEHHA)](https://oehha.ca.gov/) and the [California Open Data Portal](https://data.ca.gov/) :

-   [Versions 1.1 (Sept 2013)](https://oehha.ca.gov/calenviroscreen/report-general-info/calenviroscreen-11)
-   [Versions 2.0 (Oct 2014)](https://oehha.ca.gov/calenviroscreen/report/calenviroscreen-version-20)
-   [Versions 3.0 (June 2018)](https://data.ca.gov/dataset/calenviroscreen-3-0-results)
-   [Versions 4.0 (Oct 2021)](https://oehha.ca.gov/calenviroscreen/report/calenviroscreen-40)

Each CalEnviroScreen dataset contains columns of:

-   environmental pollution burden indicators

    -   exposure indicators such as PM2.5
    -   environmental effects indicators such as groundwater threats

-   population characteristics:

    -   sensitive population indicators such as rates of asthma
    -   socioeconomic factor indicators such as rates of poverty

![CalEnviroScreen Components (Source: <https://oehha.ca.gov/media/downloads/calenviroscreen/report/calenviroscreen40reportf2021.pdf>)](CES/CES_images/components.png){width=50%}

Each dataset also contains one row per census tract, meaning each census tract in California is assigned a value per environmental indicator or population characteristic.

In particular, I am interested in:

### 1.  **PM2.5:** 

The annual mean concentration of PM2.5, which CalEnviroScreen calculates based on a weighted average of measured monitor concentrations and satellite observations (ug/m^3^) over 3 years. For example, the CES 1.1. report used data from 2007 - 2009 while the CES 4.0 report used 2015 - 2017. All reports used data from the [California Air Resources Board's](https://ww2.arb.ca.gov/homepage) Air Monitoring Network. In addition to the Air Monitoring Network, CES 3.0 and 4.0 incorporated [Satellite Remote Sensing Data](https://ww2.arb.ca.gov/resources/documents/air-quality-research-using-satellite-remote-sensing). 

```{r}
ggplot(data = joined, aes(x = PM2.5)) + 
  geom_histogram(aes(fill = Year)) + 
  theme_classic() + 
  facet_wrap(~Year, ncol = 1) + 
  labs(title = "2013 - 2021 mean concentration of PM2.5 in California", 
       x = "Annual mean concentration of PM2.5 per census tract (ug/m3)", 
       y = "Frequency")
```

```{r}
sub <- joined %>% 
  drop_na(PM2.5)

sub %>% 
  group_by(Year) %>% 
  summarize("Mean PM2.5" = round(mean(PM2.5), digits = 2),
            "SD PM2.5" = round(sd(PM2.5), digits = 2)) %>%
  gt() %>%  
  tab_header(
    title = "Mean and standard deviation of annual mean concentrations of PM2.5 (ug/m3) in California", 
    subtitle = "Data from CalEnviroScreen"
  )
```


Data were more likely to be high resolution around certain cities or localized areas, but not all cities have air monitoring stations. Depending on the year, locales with little to no data were either omitted or estimated using nearby locations' data. For example, in CES 1.1, census tracts with centers > 50km away from the nearest air monitor were omitted from the analysis. In CES 4.0, missing data was estimated using regression relationships with nearby sites. 

PM2.5 annual mean monitoring data were extracted from all monitoring sites where possible. For CES 4.0, PM2.5 annual mean concentrations were also calculated using Aerosol Optical Depth measurements as well as land use and meteorology data via regression on ground monitor data.

For CES 1.1 - 3.0, the geographic center of each census tract, quarterly mean PM2.5 concentrations were estimated using ordinary kringing. For CES 4.0, overall PM2.5 annual mean concentrations were estimated for each 1km x 1km grid cell using both the monitoring and satellite data in a weighted average. An inverse-distance weighting method was used, so grid cells close to monitors relied more heavily on monitor estimates while grid cells further from monitors relied more heavily on satellite data. Grid cells with monitors > 50km away relied solely on satellite data. Concentrations were estimated at the center of each 1km x 1km grid cell. 

The quarterly estimates were then averaged to calculate annual means. The annual means were estimated over 3 years to avoid account for uneven sampling frequency. 

![CalEnviroScreen 4.0 PM2.5 Map (Source: <https://oehha.ca.gov/media/downloads/calenviroscreen/report/calenviroscreen40reportf2021.pdf>)](CES/CES_images/pm.png)


### 2.  **Poverty:** 

The percent of the population living below two times the federal poverty level, which CalEnviroScreen calculates using a 5-year estimate. For example, the CES 1.1 report used a 5-year estimate from 2007 - 2011 data while the CES 4.0 report used a 5-year estimate from 2015 - 2019 data. Poverty data came from the [American Community Survey](https://www.census.gov/programs-surveys/acs). Multiple years of data are used to calculate more reliable results for geographic areas with small populations.

```{r}
ggplot(data = joined, aes(x = Poverty)) + 
  geom_histogram(aes(fill = Year)) + 
  theme_classic() + 
  facet_wrap(~Year, ncol = 1) + 
  labs(title = "2013 - 2021 mean concentration of PM2.5 in California", 
       x = "% of population per census tract living below two times the federal poverty
level", 
       y = "Frequency")
```

```{r}
sub <- joined %>% 
  drop_na(Poverty)

sub %>% 
  group_by(Year) %>% 
  summarize("Mean Poverty Rate (%)" = round(mean(Poverty), digits = 2),
            "SD Poverty Rate (%)" = round(sd(Poverty), digits = 2)) %>%
  gt() %>%  
  tab_header(
    title = "Percent of census tract population living below two times the federal poverty level in California", 
    subtitle = "Data from CalEnviroScreen"
  )
```

CalEnviroScreen defined poverty as twice below the federal poverty line to account for California's high cost of living relative to other states and because the federal poverty threshold has not changed since the 1980s despite the cost of living increasing over time.

The percent per census tract was calculated by individuals living below 200% the poverty level per census tract / total individuals living below 200% of the poverty level.

Standard error and relative standard error were calculated to determine the reliability of the calculated poverty rate. Census tracts with unreliable estimates were assigned no value for poverty rate (NULL).

![CalEnviroScreen 4.0 Poverty Map (Source: <https://oehha.ca.gov/media/downloads/calenviroscreen/report/calenviroscreen40reportf2021.pdf>)](CES/CES_images/poverty.png)

Using this data, we can answer the research question...

# Statistical Analysis

What is your analysis plan? Why did you choose this analysis, given your data and question? What are the limitations?

## Q-Q Plot (2021 PM2.5)
```{r}
c4 <- subset(joined, Year == "2021")

ggplot(data = c4, aes(sample = PM2.5)) + 
  geom_qq() + 
  geom_qq_line()+ 
  theme_classic() + 
  xlab("Normal distribution quantiles") +
  ylab("Sample quantiles") + theme_bw() + 
  theme(
    line = element_blank(),
  panel.grid = element_blank(),
  rect = element_blank(),
  strip.text = element_blank(),
  axis.text.x = element_text(size = 10),
  axis.text.y = element_text(size = 10),
  axis.title = element_text(size=10,face="bold"),
  plot.title = element_blank(),
  legend.position = "none")

ggplot(data = c4, aes(x = PM2.5)) + 
  geom_histogram(binwidth = 1) + 
  theme_classic() + 
  labs(title = "2021 mean concentration of PM2.5 in California", 
       x = "Annual mean concentration of PM2.5 per census tract (ug/m3)", 
       y = "Frequency")
```
```{r}
levene.test(c4$PM2.5, c4$Poverty)
```




# Results

Show us your results in figure(s) and/or table(s) that are carefully labeled and captioned. Describe in the text (and orally when presenting) what you found, and how these results either do or do not help you answer your question.

```{r}
mod <- lm(PM2.5 ~ Poverty, data = c4)
mod <- lm(PM2.5 ~ Poverty + Year, data = joined)
summary(mod)
```

## Figures

```{r}
sub <- joined %>% 
  drop_na(Poverty, PM2.5)

ggplot(data = sub, aes(x = Poverty, y = PM2.5)) +
  geom_point(aes(color = Year), alpha = 0.1) + 
  geom_smooth(method='lm', 
              formula= y~x,
              size=1.5) + 
  theme_classic()
```

# Conclusions

# Future Directions

One short analysis cannot fully answer an interesting scientific question. If you had time to collect more data or conduct more analysis, what would help you answer this question better?
